---
title: Setting up SSH
description: 
tags: 
publish: true
---

This section deals with setting up an SSH client and server and running a secure connection between them.

### Installation
The installation process for SSH client and server software varies depending on the operating system being used. Here's a general overview of the installation steps for SSH client and server:
1. **SSH Client Installation**
    - Determine the SSH client software to be installed. Popular options include *OpenSSH (command-line tool)*, *PuTTY (Windows GUI client)*, and *Bitvise SSH Client (Windows GUI client)*.
    - Visit the official website or trusted sources for the chosen SSH client software.
    - Download the installer package appropriate for the chosen operating system.
    - Run the installer package and follow the on-screen instructions.
    - Once the installation is complete, the SSH client should be ready to use.
2. **SSH Server Installation**
    - Determine the SSH server software to be installed. The most widely used SSH server implementation is *OpenSSH*.
    - OpenSSH is *often included as a default* component in many Linux and Unix-like operating systems. However, if it is not already installed, you can typically install it through the package manager of the chosen operating system.
    - For Linux distributions, such as Ubuntu, Debian, or CentOS, use the package manager (e.g., apt, yum) to install the OpenSSH server package.
    - On Windows, OpenSSH Server can be installed through the Windows PowerShell or by using the OpenSSH installer provided by Microsoft.
    - During the installation process, options to configure the SSH port, authentication methods, and other security-related options are presented to the user and can be customized.
    - Once the installation is complete, the SSH server should be ready to accept incoming SSH connections.

It's important to note that specific instructions and package names may vary depending on the chosen operating system and distribution. It's recommended to consult the official documentation or resources specific to the chosen SSH client or server software for detailed installation instructions. Additionally, some operating systems may have pre-installed SSH client or server software, while others may require manual installation.

### Authentication Methods
The following are some of the authentication methods used with SSH
1. **Password-based Authentication**
    - Users provide their *username* and *password* to authenticate themselves.
    - The server verifies the provided credentials against a stored user database (e.g., /etc/passwd, LDAP, or Active Directory).
    - Password-based authentication is a common method but may be less secure compared to other methods, especially if weak or easily guessable passwords are used.
2. **Public Key-based Authentication**
    - Public key authentication uses asymmetric key pairs, meaning a *public key* and a *corresponding private key*.
    - The *user generates a key pair* on their local machine and *stores the public key on the remote server*.
    - During authentication, the client proves its identity by presenting its private key, and the server verifies it using the stored public key.
    - Public key-based authentication is *highly secure and recommended for SSH*. It eliminates the need to transmit passwords over the network and protects against password-based attacks.
    - This is the *most common type of authentication* used with SSH.
3. **Keyboard-Interactive Authentication**
    - Keyboard-interactive authentication is a *flexible and customizable authentication method*.
    - It can prompt users for various types of credentials, such as passwords, one-time passwords, or challenge-response questions.
    - This method allows for *multiple rounds of interaction* between the client and server during the authentication process.
    - Keyboard-interactive authentication can be used as a *fallback method* when other authentication methods fail or are unavailable.
4. **Certificate-based Authentication**
    - Certificate-based authentication uses *digital certificates issued by a trusted Certificate Authority (CA)*.
    - Similar to public key-based authentication, the user presents a client certificate instead of a private key.
    - The server verifies the authenticity of the certificate by checking its validity and the CA's signature.
    - Certificate-based authentication provides an extra layer of trust, as the CA validates the user's identity.
5. **Two-factor Authentication (2FA)**
    - Two-factor authentication combines multiple authentication factors to enhance security.
    - It typically involves *combining something the user knows* (e.g., a password) with *something the user has* (e.g., a mobile device or hardware token).
    - SSH servers can be configured to require both a password and a second factor, such as a one-time password generated by a mobile app or hardware token.

SSH allows for configuring and enforcing authentication methods based on security requirements and user preferences. The choice of authentication method depends on the level of security desired, ease of use, and available infrastructure. Public key-based authentication is generally recommended for its strong security properties, while additional methods like two-factor authentication can provide extra layers of protection.

Password-based authentication & Public Key-based authentication are the most common methods of setting up SSH fore remote machines. Hence this guide will go over these two methods.

#### Password-based Authentication 
The `ssh` command can be used to connect to the remote server. The command follows the general syntax as showcased below.

```bash
# Syntax
ssh username@server_ip

# Example 
ssh root@178.231.67.39
```

Upon execution of this command, the client requests an SSH connection to the user at the requested IP address. The server then waits for the user to enter the password to connect to the server. Upon reception of the verified password, the client and server are connected via SSH and the client can execute commands on the server via SSH. 

This method is however not recommended as the integrity of this method depends on the efficient management of the password by the user, plus it also open up for password compromises and brute force attacks. 

#### Public Key-Based Authentication
Public Key-based authentication uses an asymmetric key-pair to authenticate the user making the remote connection. There are a few steps involved in setting up a key-pair based authentication. The general process is outlined below.
1. **Key-pair Generation** - A key-pair is generated on the client machine using the `ssh-keygen` command. There are several encryption algorithms that can be used to generate key-pairs each with their pros, cons and legacy. There is an option to set a key-phrase for accessing the key-pair, and it is recommended to set it up as it adds an additional layer of authentication on top of the SSH key.   
2. **Copy Public Key to Server** - The public key part of the key-pair is then transferred to the server. But the private key remains on the client and is kept safe.
3. **Client Initiates SSH Connection** - The SSH client initiates a connection to the SSH server using the `ssh` command. The client presents its private key to the server for authentication.  
4. Server Verifies Public Key - The server (`sshd`) checks the client's public key against the authorized keys file for the user that the client is requesting access to. If a matching public key is found, the server accepts the connection and authenticates the client. If the key does not match or is not present, the server denies access.
5. **Authenticated Session Established** - Once the server verifies the client's public key, an authenticated session is established. The client can interact securely with the server using SSH commands or transfer files securely.

Following code snippet showcases the commonly used encryption algorithms used to generate a key-pair.

```bash
# RSA
ssh-keygen -t rsa -b 2048
ssh-keygen -t rsa -b 2048 -C "Comment on Key"

# DSA
ssh-keygen -t dsa -b 2048
ssh-keygen -t dsa -b 2048 -C "Comment on Key"

# ECDSA
ssh-keygen -t ecdsa -b 256
ssh-keygen -t ecdsa -b 256 -C "Comment on Key"

# ED25519
ssh-keygen -t ed25519
ssh-keygen -t ed25519 -C "Comment on Key"
```

The `-C` flag can be used to supply a comment for the Key. This can be useful in identifying the purpose of why the key was generated.

The following table summarizes the different encryption algorithms.

| Encryption Algorithm                                   | Description                                                                                                                                                                                                                                                                |
| ------------------------------------------------------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **RSA** (Rivest-Shamir-Adleman)                        | RSA is a *widely used* asymmetric encryption algorithm. It offers *strong security and good performance*. RSA key pairs are compatible with almost all SSH clients and servers.                                                                                            |
| **DSA** (Digital Signature Algorithm)                  | DSA is an *older asymmetric encryption algorithm*. It provides *strong security* but may have *slower performance* compared to RSA. DSA key pairs are compatible with most SSH clients and servers, but some implementations have *deprecated or limited support* for DSA. |
| **ECDSA** (Elliptic Curve Digital Signature Algorithm) | ECDSA is an asymmetric encryption algorithm based on *elliptic curve cryptography*. It offers *strong security* with *shorter key lengths*, resulting in *improved performance*. ECDSA key pairs are supported by many modern SSH implementations.                         |
| **Ed25519**                                            | Ed25519 is a newer asymmetric encryption algorithm based on *elliptic curve cryptography*. It provides *strong security*, *excellent performance*, and *smaller key sizes* compared to RSA and DSA. Ed25519 key pairs are supported by many modern SSH implementations.    |

After generating the key-pair, the key pair needs to be moved to the SSH server. This task can be accomplished by a number of ways. 

1. **Using `ssh-copy-id` command**
    - The `ssh-copy-id` command simplifies the process of copying the public key to the server.  
    - This command copies the public key to the remote server and adds it to the `authorized_keys` file in the user's home directory.
2. **Manual Copying**
    - If the `ssh-copy-id` command is not available or not suitable for your system, you can manually copy the public key to the server.
    - On the client machine, use a text editor or command-line tools to open the public key file (`~/.ssh/id_rsa.pub`, `~/.ssh/id_dsa.pub`, `~/.ssh/id_ecdsa.pub`, or `~/.ssh/id_ed25519.pub`).
    - Copy the contents of the public key file.
    - On the server, open the `~/.ssh/authorized_keys` file (create it if it doesn't exist) in a text editor.
    - Paste the copied public key into a new line in the `authorized_keys` file and save it.
3. **Secure File Transfer**
    - Use a secure file transfer method, such as SCP or SFTP, to transfer the public key file to the server.
    - Example using SCP:
        `scp ~/.ssh/id_rsa.pub username@server_ip:~/.ssh/authorized_keys`
    - This command copies the public key file directly to the `authorized_keys` file on the server

```shell
# Using the ssh-copy-id command
ssh-copy-id -i <public-key-path> username@server_ip

# Using Secure Copy (or) SCP

# Step 1: Copy the public key to the remote machine
scp <public-key-path> usernameo@server_ip:<path-on-target-machine>

# Step 2: SSH into the server with password authentication
ssh username@server_ip
# Enter the password when prompted -> Should take to the home dir

# Step 3: Ensure ~/.ssh/authorized_keys keys file exists
touch ~/.ssh/authorized_keys

# Step 4: Append the copied public key to the authorized_keys file
cat <public-key-path> >> ~/.ssh/authorized_keys

# Step 5: Ensure correct read,write permissions are set
chmod 700 ~/.ssh && chmod 600 ~/.ssh/authorized_keys
# Here sudo is most likely not required, but if prompted use 'sudo'
```

That being said, one must almost always go with the `ssh-copy-id` route as it is clean, simple and gets the job done quickly. The other methods provide a way to perform the same action just in case somehow the `ssh-copy-id` command is unavailable.

